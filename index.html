<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Financiamento Habitacional</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="icon" href="icons/icon-192.png">
  <style>
    :root{--bg:#ffffff;--fg:#0f172a;--muted:#475569;--pri:#0ea5e9;--ok:#16a34a;--warn:#eab308;--err:#dc2626;--card:#f8fafc;}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;background:var(--bg);color:var(--fg)}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e2e8f0;padding:.75rem 1rem;display:flex;gap:.75rem;align-items:center;z-index:10}
    header h1{font-size:1.05rem;margin:0;flex:1}
    main{padding:1rem;max-width:980px;margin:0 auto}
    .row{display:grid;grid-template-columns:1fr;gap:1rem}
    @media(min-width:800px){.row{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid #e2e8f0;border-radius:1rem;padding:1rem}
    .kpi{font-size:1.75rem;font-weight:700;margin:.25rem 0}
    .muted{color:var(--muted);font-size:.9rem}
    button{background:var(--pri);color:#fff;border:0;border-radius:.75rem;padding:.7rem 1rem;font-weight:600}
    button.secondary{background:#0f172a0D;color:#0f172a}
    input,select{width:100%;padding:.6rem .7rem;border:1px solid #cbd5e1;border-radius:.6rem;font-size:1rem}
    label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:.35rem}
    table{width:100%;border-collapse:collapse;font-size:.9rem}
    th,td{padding:.5rem;border-bottom:1px solid #e2e8f0;text-align:right}
    th:first-child, td:first-child{text-align:left}
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
    dialog{border:0;border-radius:1rem;padding:0;max-width:520px;width:92%}
    dialog .box{padding:1rem}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    .tag{display:inline-block;padding:.15rem .5rem;border-radius:999px;font-size:.8rem;border:1px solid #cbd5e1}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .fine{font-size:.8rem;color:var(--muted)}
    footer{padding:2rem 1rem;color:var(--muted);text-align:center}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
  </style>
</head>
<body>
  <header>
    <h1>Financiamento Habitacional — PWA (instalável)</h1>
    <button id="btnInstall" class="secondary" title="Instalar no celular">Instalar</button>
  </header>

  <main>
    <div class="row">
      <section class="card">
        <h2>Dashboard</h2>
        <div class="muted">Dados do contrato (SAC, TR). Taxa nominal anual 9,3764% a.a. • Saldo atual a partir dos seus documentos.</div>
        <div class="grid2" style="margin-top:.75rem">
          <div>
            <div class="muted">Saldo devedor</div>
            <div class="kpi" id="kpiSaldo">—</div>
            <div class="fine" id="lblDataSaldo"></div>
          </div>
          <div>
            <div class="muted">Prazo estimado (meses)</div>
            <div class="kpi" id="kpiPrazo">—</div>
            <div class="fine">Recalculado a cada pagamento/amortização</div>
          </div>
          <div>
            <div class="muted">Meta (máx.)</div>
            <div class="kpi">50 meses</div>
            <div class="fine">Se passar de 50 meses, sugerimos extra mensal</div>
          </div>
          <div>
            <div class="muted">Extra mensal sugerido p/ 50m</div>
            <div class="kpi" id="kpiExtra">—</div>
            <div class="fine" id="lblExtra"></div>
          </div>
        </div>
        <div class="toolbar" style="margin-top:1rem">
          <button id="btnRegistrar">Registrar pagamento / amortização extra</button>
          <button id="btnRecalcular" class="secondary">Recalcular</button>
        </div>
      </section>

      <section class="card">
        <h2>Configurações</h2>
        <div class="grid2">
          <div>
            <label>Taxa de juros anual nominal (%)</label>
            <input type="number" step="0.0001" id="txAnual" />
          </div>
          <div>
            <label>TR mensal (ex.: 0.03)</label>
            <input type="number" step="0.0001" id="trMensal" />
          </div>
          <div>
            <label>Sistema</label>
            <select id="sistema">
              <option value="SAC">SAC</option>
              <option value="PRICE">Price</option>
            </select>
          </div>
          <div>
            <label>Meta de prazo (meses)</label>
            <input type="number" id="metaMeses" value="50"/>
          </div>
        </div>
        <div class="fine" style="margin-top:.5rem">
          Fonte dos dados do contrato: seus documentos PDF (SAC, TR, 9,3764% a.a., saldo). 
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:1rem">
      <h2>Histórico de parcelas e eventos</h2>
      <div class="fine">Inclui pagamentos normais e amortizações extras. Campo “Valor da parcela amortizada” aparece para eventos de amortização extra.</div>
      <div id="tblWrap" style="overflow:auto">
        <table id="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>Data</th>
              <th>Tipo</th>
              <th>Amortização (R$)</th>
              <th>Juros (R$)</th>
              <th>Parcela (R$)</th>
              <th>Saldo (R$)</th>
              <th>Δ Meses</th>
              <th>Parcela amortizada (R$)</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <dialog id="dlg">
      <div class="box">
        <h3>Registrar pagamento / amortização extra</h3>
        <div class="grid2">
          <div>
            <label>Data</label>
            <input type="date" id="inpData">
          </div>
          <div>
            <label>Tipo</label>
            <select id="inpTipo">
              <option value="PAGAMENTO">Pagamento normal</option>
              <option value="EXTRA">Amortização extra</option>
            </select>
          </div>
          <div>
            <label>Valor pago (R$)</label>
            <input type="number" step="0.01" id="inpValor">
          </div>
          <div>
            <label>Observações</label>
            <input id="inpObs" placeholder="opcional">
          </div>
        </div>
        <div class="toolbar" style="margin-top:1rem;justify-content:flex-end">
          <button id="btnCancelar" class="secondary">Cancelar</button>
          <button id="btnConfirmar">Confirmar</button>
        </div>
      </div>
    </dialog>

  </main>

  <footer>
    PWA instalável • Funciona offline • Salva no dispositivo (localStorage)
  </footer>

  <script src="data/history.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('service-worker.js'));
    }
  </script>
</body>
</html>
